/*
 Platform.js <https://mths.be/platform>
 Copyright 2014-2018 Benjamin Tan <https://bnjmnt4n.now.sh/>
 Copyright 2011-2013 John-David Dalton
 Available under MIT license <https://mths.be/mit>
*/
(function(){function b(r){r=String(r);return r.charAt(0).toUpperCase()+r.slice(1)}function d(r,x){var p=-1,l=r?r.length:0;if("number"==typeof l&&-1<l&&l<=z)for(;++p<l;)x(r[p],p,r);else f(r,x)}function e(r){r=String(r).replace(/^ +| +$/g,"");return/^(?:webOS|i(?:OS|P))/.test(r)?r:b(r)}function f(r,x){for(var p in r)A.call(r,p)&&x(r[p],p,r)}function m(r){return null==r?b(r):H.call(r).slice(8,-1)}function n(r,x){var p=null!=r?typeof r[x]:"number";return!/^(?:boolean|number|string|undefined)$/.test(p)&&
("object"==p?!!r[x]:!0)}function h(r){return String(r).replace(/([ -])(?!$)/g,"$1?")}function g(r,x){var p=null;d(r,function(l,B){p=x(p,l,B,r)});return p}function c(r){function x(P){return g(P,function(O,M){var T=M.pattern||h(M);!O&&(O=RegExp("\\b"+T+" *\\d+[.\\w_]*","i").exec(r)||RegExp("\\b"+T+" *\\w+-[\\w]*","i").exec(r)||RegExp("\\b"+T+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(r))&&((O=String(M.label&&!RegExp(T,"i").test(M.label)?M.label:O).split("/"))[1]&&!/[\d.]+/.test(O[0])&&(O[0]+=
" "+O[1]),M=M.label||M,O=e(O[0].replace(RegExp(T,"i"),M).replace(RegExp("; *(?:"+M+"[_-])?","i")," ").replace(RegExp("("+M+")[-_.]?(\\w)","i"),"$1 $2")));return O})}function p(P){return g(P,function(O,M){return O||(RegExp(M+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(r)||0)[1]||null})}var l=u,B=r&&"object"==typeof r&&"String"!=m(r);B&&(l=r,r=null);var I=l.navigator||{},C=I.userAgent||"";r||(r=C);var X=B?!!I.likeChrome:/\bChrome\b/.test(r)&&!/internal|\n/i.test(H.toString()),
R=B?"Object":"ScriptBridgingProxyObject",N=B?"Object":"Environment",Q=B&&l.java?"JavaPackage":m(l.java),V=B?"Object":"RuntimeObject";N=(Q=/\bJava/.test(Q)&&l.java)&&m(l.environment)==N;var Z=Q?"a":"\u03b1",Y=Q?"b":"\u03b2",aa=l.document||{},S=l.operamini||l.opera,k=F.test(k=B&&S?S["[[Class]]"]:m(S))?k:S=null,a,y=r;B=[];var t=null,G=r==C;C=G&&S&&"function"==typeof S.version&&S.version();var J=function(P){return g(P,function(O,M){return O||RegExp("\\b"+(M.pattern||h(M))+"\\b","i").exec(r)&&(M.label||
M)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),D=function(P){return g(P,function(O,M){return O||RegExp("\\b"+(M.pattern||h(M))+"\\b","i").exec(r)&&(M.label||M)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser",
"PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},
{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),L=x([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad",
"iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),U=function(P){return g(P,function(O,M,T){return O||(M[L]||M[/^[a-z]+(?: +[a-z]+\b)*/i.exec(L)]||RegExp("\\b"+h(T)+"(?:\\b|\\w*\\d)","i").exec(r))&&T})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},
"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),E=function(P){return g(P,function(O,M){var T=M.pattern||h(M);if(!O&&(O=RegExp("\\b"+T+"(?:/[\\d.]+|[ \\w.]*)","i").exec(r))){var W=O,ba=M.label||M,ca={"10.0":"10","6.4":"10 Technical Preview",
"6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};T&&ba&&/^Win/i.test(W)&&!/^Windows Phone /i.test(W)&&(ca=ca[/[\d.]+$/.exec(W)])&&(W="Windows "+ca);W=String(W);T&&ba&&(W=W.replace(RegExp(T,"i"),ba));O=W=e(W.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,
"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return O})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X",
"Macintosh","Mac","Windows 98;","Windows "]);J&&(J=[J]);U&&!L&&(L=x([U]));if(a=/\bGoogle TV\b/.exec(L))L=a[0];/\bSimulator\b/i.test(r)&&(L=(L?L+" ":"")+"Simulator");"Opera Mini"==D&&/\bOPiOS\b/.test(r)&&B.push("running in Turbo/Uncompressed mode");"IE"==D&&/\blike iPhone OS\b/.test(r)?(a=c(r.replace(/like iPhone OS/,"")),U=a.manufacturer,L=a.product):/^iP/.test(L)?(D||(D="Safari"),E="iOS"+((a=/ OS ([\d_]+)/i.exec(r))?" "+a[1].replace(/_/g,"."):"")):"Konqueror"!=D||/buntu/i.test(E)?U&&"Google"!=U&&
(/Chrome/.test(D)&&!/\bMobile Safari\b/i.test(r)||/\bVita\b/.test(L))||/\bAndroid\b/.test(E)&&/^Chrome/.test(D)&&/\bVersion\//i.test(r)?(D="Android Browser",E=/\bAndroid\b/.test(E)?E:"Android"):"Silk"==D?(/\bMobi/i.test(r)||(E="Android",B.unshift("desktop mode")),/Accelerated *= *true/i.test(r)&&B.unshift("accelerated")):"PaleMoon"==D&&(a=/\bFirefox\/([\d.]+)\b/.exec(r))?B.push("identifying as Firefox "+a[1]):"Firefox"==D&&(a=/\b(Mobile|Tablet|TV)\b/i.exec(r))?(E||(E="Firefox OS"),L||(L=a[1])):!D||
(a=!/\bMinefield\b/i.test(r)&&/\b(?:Firefox|Safari)\b/.exec(D))?(D&&!L&&/[\/,]|^[^(]+?\)/.test(r.slice(r.indexOf(a+"/")+8))&&(D=null),(a=L||U||E)&&(L||U||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(E))&&(D=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(E)?E:a)+" Browser")):"Electron"==D&&(a=(/\bChrome\/([\d.]+)\b/.exec(r)||0)[1])&&B.push("Chromium "+a):E="Kubuntu";C||(C=p(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",h(D),
"(?:Firefox|Minefield|NetFront)"]));if(a="iCab"==J&&3<parseFloat(C)&&"WebKit"||/\bOpera\b/.test(D)&&(/\bOPR\b/.test(r)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(r)&&!/^(?:Trident|EdgeHTML)$/.test(J)&&"WebKit"||!J&&/\bMSIE\b/i.test(r)&&("Mac OS"==E?"Tasman":"Trident")||"WebKit"==J&&/\bPlayStation\b(?! Vita\b)/i.test(D)&&"NetFront")J=[a];"IE"==D&&(a=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(r)||0)[1])?(D+=" Mobile",E="Windows Phone "+(/\+$/.test(a)?a:a+".x"),B.unshift("desktop mode")):/\bWPDesktop\b/i.test(r)?
(D="IE Mobile",E="Windows Phone 8.x",B.unshift("desktop mode"),C||(C=(/\brv:([\d.]+)/.exec(r)||0)[1])):"IE"!=D&&"Trident"==J&&(a=/\brv:([\d.]+)/.exec(r))&&(D&&B.push("identifying as "+D+(C?" "+C:"")),D="IE",C=a[1]);if(G){if(n(l,"global"))if(Q&&(a=Q.lang.System,y=a.getProperty("os.arch"),E=E||a.getProperty("os.name")+" "+a.getProperty("os.version")),N){try{C=l.require("ringo/engine").version.join("."),D="RingoJS"}catch(P){(a=l.system)&&a.global.system==l.system&&(D="Narwhal",E||(E=a[0].os||null))}D||
(D="Rhino")}else"object"==typeof l.process&&!l.process.browser&&(a=l.process)&&("object"==typeof a.versions&&("string"==typeof a.versions.electron?(B.push("Node "+a.versions.node),D="Electron",C=a.versions.electron):"string"==typeof a.versions.nw&&(B.push("Chromium "+C,"Node "+a.versions.node),D="NW.js",C=a.versions.nw)),D||(D="Node.js",y=a.arch,E=a.platform,C=(C=/[\d.]+/.exec(a.version))?C[0]:null));else m(a=l.runtime)==R?(D="Adobe AIR",E=a.flash.system.Capabilities.os):m(a=l.phantom)==V?(D="PhantomJS",
C=(a=a.version||null)&&a.major+"."+a.minor+"."+a.patch):"number"==typeof aa.documentMode&&(a=/\bTrident\/(\d+)/i.exec(r))?(C=[C,aa.documentMode],(a=+a[1]+4)!=C[1]&&(B.push("IE "+C[1]+" mode"),J&&(J[1]=""),C[1]=a),C="IE"==D?String(C[1].toFixed(1)):C[0]):"number"==typeof aa.documentMode&&/^(?:Chrome|Firefox)\b/.test(D)&&(B.push("masking as "+D+" "+C),D="IE",C="11.0",J=["Trident"],E="Windows");E=E&&e(E)}C&&(a=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(C)||/(?:alpha|beta)(?: ?\d)?/i.exec(r+";"+(G&&
I.appMinorVersion))||/\bMinefield\b/i.test(r)&&"a")&&(t=/b/i.test(a)?"beta":"alpha",C=C.replace(RegExp(a+"\\+?$"),"")+("beta"==t?Y:Z)+(/\d+\+?/.exec(a)||""));if("Fennec"==D||"Firefox"==D&&/\b(?:Android|Firefox OS)\b/.test(E))D="Firefox Mobile";else if("Maxthon"==D&&C)C=C.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(L))"Xbox 360"==L&&(E=null),"Xbox 360"==L&&/\bIEMobile\b/.test(r)&&B.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(D)&&(!D||L||/Browser|Mobi/.test(D))||"Windows CE"!=
E&&!/Mobi/i.test(r))if("IE"==D&&G)try{null===l.external&&B.unshift("platform preview")}catch(P){B.unshift("embedded")}else(/\bBlackBerry\b/.test(L)||/\bBB10\b/.test(r))&&(a=(RegExp(L.replace(/ +/g," *")+"/([.\\d]+)","i").exec(r)||0)[1]||C)?(a=[a,/BB10/.test(r)],E=(a[1]?(L=null,U="BlackBerry"):"Device Software")+" "+a[0],C=null):this!=f&&"Wii"!=L&&(G&&S||/Opera/.test(D)&&/\b(?:MSIE|Firefox)\b/i.test(r)||"Firefox"==D&&/\bOS X (?:\d+\.){2,}/.test(E)||"IE"==D&&(E&&!/^Win/.test(E)&&5.5<C||/\bWindows XP\b/.test(E)&&
8<C||8==C&&!/\bTrident\b/.test(r)))&&!F.test(a=c.call(f,r.replace(F,"")+";"))&&a.name&&(a="ing as "+a.name+((a=a.version)?" "+a:""),F.test(D)?(/\bIE\b/.test(a)&&"Mac OS"==E&&(E=null),a="identify"+a):(a="mask"+a,D=k?e(k.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(a)&&(E=null),G||(C=null)),J=["Presto"],B.push(a));else D+=" Mobile";if(a=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(r)||0)[1]){a=[parseFloat(a.replace(/\.(\d)$/,".0$1")),a];if("Safari"==D&&"+"==a[1].slice(-1))D="WebKit Nightly",t="alpha",
C=a[1].slice(0,-1);else if(C==a[1]||C==(a[2]=(/\bSafari\/([\d.]+\+?)/i.exec(r)||0)[1]))C=null;a[1]=(/\bChrome\/([\d.]+)/i.exec(r)||0)[1];537.36==a[0]&&537.36==a[2]&&28<=parseFloat(a[1])&&"WebKit"==J&&(J=["Blink"]);G&&(X||a[1])?(J&&(J[1]="like Chrome"),a=a[1]||(a=a[0],530>a?1:532>a?2:532.05>a?3:533>a?4:534.03>a?5:534.07>a?6:534.1>a?7:534.13>a?8:534.16>a?9:534.24>a?10:534.3>a?11:535.01>a?12:535.02>a?"13+":535.07>a?15:535.11>a?16:535.19>a?17:536.05>a?18:536.1>a?19:537.01>a?20:537.11>a?"21+":537.13>a?
23:537.18>a?24:537.24>a?25:537.36>a?26:"Blink"!=J?"27":"28")):(J&&(J[1]="like Safari"),a=(a=a[0],400>a?1:500>a?2:526>a?3:533>a?4:534>a?"4+":535>a?5:537>a?6:538>a?7:601>a?8:"8"));J&&(J[1]+=" "+(a+="number"==typeof a?".x":/[.+]/.test(a)?"":"+"));"Safari"==D&&(!C||45<parseInt(C))&&(C=a)}"Opera"==D&&(a=/\bzbov|zvav$/.exec(E))?(D+=" ",B.unshift("desktop mode"),"zvav"==a?(D+="Mini",C=null):D+="Mobile",E=E.replace(RegExp(" *"+a+"$"),"")):"Safari"==D&&/\bChrome\b/.exec(J&&J[1])&&(B.unshift("desktop mode"),
D="Chrome Mobile",C=null,/\bOS X\b/.test(E)?(U="Apple",E="iOS 4.3+"):E=null);C&&0==C.indexOf(a=/[\d.]+$/.exec(E))&&-1<r.indexOf("/"+a+"-")&&(E=String(E.replace(a,"")).replace(/^ +| +$/g,""));J&&!/\b(?:Avant|Nook)\b/.test(D)&&(/Browser|Lunascape|Maxthon/.test(D)||"Safari"!=D&&/^iOS/.test(E)&&/\bSafari\b/.test(J[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(D)&&J[1])&&(a=J[J.length-1])&&B.push(a);B.length&&(B=["("+B.join("; ")+")"]);U&&L&&0>L.indexOf(U)&&
B.push("on "+U);L&&B.push((/^on /.test(B[B.length-1])?"":"on ")+L);if(E){var da=(a=/ ([\d.+]+)$/.exec(E))&&"/"==E.charAt(E.length-a[0].length-1);E={architecture:32,family:a&&!da?E.replace(a[0],""):E,version:a?a[1]:null,toString:function(){var P=this.version;return this.family+(P&&!da?" "+P:"")+(64==this.architecture?" 64-bit":"")}}}(a=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(y))&&!/\bi686\b/i.test(y)?(E&&(E.architecture=64,E.family=E.family.replace(RegExp(" *"+a),"")),D&&(/\bWOW64\b/i.test(r)||G&&
/\w(?:86|32)$/.test(I.cpuClass||I.platform)&&!/\bWin64; x64\b/i.test(r))&&B.unshift("32-bit")):E&&/^OS X/.test(E.family)&&"Chrome"==D&&39<=parseFloat(C)&&(E.architecture=64);r||(r=null);l={};l.description=r;l.layout=J&&J[0];l.manufacturer=U;l.name=D;l.prerelease=t;l.product=L;l.ua=r;l.version=D&&C;l.os=E||{architecture:null,family:null,version:null,toString:function(){return"null"}};l.parse=c;l.toString=function(){return this.description||""};l.version&&B.unshift(C);l.name&&B.unshift(D);E&&D&&(E!=
String(E).split(" ")[0]||E!=D.split(" ")[0]&&!L)&&B.push(L?"("+E+")":"on "+E);B.length&&(l.description=B.join(" "));return l}var q={"function":!0,object:!0},u=q[typeof window]&&window||this,v=q[typeof exports]&&exports;q=q[typeof module]&&module&&!module.nodeType&&module;var w=v&&q&&"object"==typeof global&&global;!w||w.global!==w&&w.window!==w&&w.self!==w||(u=w);var z=Math.pow(2,53)-1,F=/\bOpera/;w=Object.prototype;var A=w.hasOwnProperty,H=w.toString,K=c();"function"==typeof define&&"object"==typeof define.amd&&
define.amd?(u.platform=K,define(function(){return K})):v&&q?f(K,function(r,x){v[x]=r}):u.platform=K}).call(this);
function buildIOSMeta(){for(var b=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],d=0;d<b.length;d++){var e=document.createElement("meta");e.name=b[d].name;e.content=b[d].content;var f=window.document.head.querySelector('meta[name="'+e.name+'"]');f&&f.parentNode.removeChild(f);window.document.head.appendChild(e)}}
function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none");jQuery(".xxx-ios-fullscreen-scroll").css("display","none");jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}
function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block");jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}
function __iosResize(){window.scrollTo(0,0);console.log(window.devicePixelRatio);console.log(window.innerWidth);console.log(window.innerHeight);if("iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();
break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize();setTimeout(function(){__iosResize()},500)}
function iosInIframe(){try{return window.self!==window.top}catch(b){return!0}}function isIOSLessThen13(){var b=platform.os,d=b.family.toLowerCase();b=parseFloat(b.version);return"ios"===d&&13>b?!0:!1}$(document).ready(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&(buildIOSFullscreenPanel(),buildIOSMeta())});
jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&iosResize()});
(function(){var b="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},d="undefined"!==typeof module&&module.exports,e=function(){for(var n,h=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),
"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],g=0,c=h.length,q={};g<c;g++)if((n=h[g])&&n[1]in b){for(g=0;g<n.length;g++)q[h[0][g]]=n[g];return q}return!1}(),f={change:e.fullscreenchange,error:e.fullscreenerror},m={request:function(n){return new Promise(function(h,g){var c=function(){this.off("change",
c);h()}.bind(this);this.on("change",c);n=n||b.documentElement;Promise.resolve(n[e.requestFullscreen]())["catch"](g)}.bind(this))},exit:function(){return new Promise(function(n,h){if(this.isFullscreen){var g=function(){this.off("change",g);n()}.bind(this);this.on("change",g);Promise.resolve(b[e.exitFullscreen]())["catch"](h)}else n()}.bind(this))},toggle:function(n){return this.isFullscreen?this.exit():this.request(n)},onchange:function(n){this.on("change",n)},onerror:function(n){this.on("error",n)},
on:function(n,h){var g=f[n];g&&b.addEventListener(g,h,!1)},off:function(n,h){var g=f[n];g&&b.removeEventListener(g,h,!1)},raw:e};e?(Object.defineProperties(m,{isFullscreen:{get:function(){return!!b[e.fullscreenElement]}},element:{enumerable:!0,get:function(){return b[e.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return!!b[e.fullscreenEnabled]}}}),d?module.exports=m:window.screenfull=m):d?module.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})();
var s_iScaleFactor=1,s_bIsIphone=!1,s_iOffsetX,s_iOffsetY,s_bFocus=!0;
(function(b){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(b.substr(0,4))})(navigator.userAgent||
navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(b){console.log(b)}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function isIpad(){var b=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");return!b&&navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints?!0:b}function isMobile(){return isIpad()?!0:jQuery.browser.mobile}
function isIOS(){var b="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");if(-1!==navigator.userAgent.toLowerCase().indexOf("iphone"))return s_bIsIphone=!0;for(;b.length;)if(navigator.platform===b.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}
function getSize(b){var d=b.toLowerCase(),e=window.document,f=e.documentElement;if(void 0===window["inner"+b])b=f["client"+b];else if(window["inner"+b]!=f["client"+b]){var m=e.createElement("body");m.id="vpw-test-b";m.style.cssText="overflow:scroll";var n=e.createElement("div");n.id="vpw-test-d";n.style.cssText="position:absolute;top:-1000px";n.innerHTML="<style>@media("+d+":"+f["client"+b]+"px){body#vpw-test-b div#vpw-test-d{"+d+":7px!important}}</style>";m.appendChild(n);f.insertBefore(m,e.head);
b=7==n["offset"+b]?f["client"+b]:window["inner"+b];f.removeChild(m)}else b=window["inner"+b];return b}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}
function getHeightOfIOSToolbars(){var b=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<b?b:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var b=null!==platform.name&&"safari"===platform.name.toLowerCase()?getIOSWindowHeight():getSize("Height");var d=getSize("Width");s_bFocus&&_checkOrientation(d,b);var e=Math.min(b/CANVAS_HEIGHT,d/CANVAS_WIDTH),f=Math.round(CANVAS_WIDTH*e);e=Math.round(CANVAS_HEIGHT*e);if(e<b){var m=b-e;e+=m;f+=CANVAS_WIDTH/CANVAS_HEIGHT*m}else f<d&&(m=d-f,f+=m,e+=CANVAS_HEIGHT/CANVAS_WIDTH*m);m=b/2-e/2;var n=d/2-f/2,h=CANVAS_WIDTH/f;if(n*h<-EDGEBOARD_X||
m*h<-EDGEBOARD_Y)e=Math.min(b/(CANVAS_HEIGHT-2*EDGEBOARD_Y),d/(CANVAS_WIDTH-2*EDGEBOARD_X)),f=Math.round(CANVAS_WIDTH*e),e=Math.round(CANVAS_HEIGHT*e),m=(b-e)/2,n=(d-f)/2,h=CANVAS_WIDTH/f;s_iOffsetX=-1*n*h;s_iOffsetY=-1*m*h;0<=m&&(s_iOffsetY=0);0<=n&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oLevelMenu&&s_oLevelMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);s_oStage&&(s_oStage.canvas.width=
f,s_oStage.canvas.height=e);0>m||(m=(b-e)/2);$("#canvas").css("top",m+"px");$("#canvas").css("left",n+"px");fullscreenHandler();s_iScaleFactor=Math.min(f/CANVAS_WIDTH,e/CANVAS_HEIGHT);s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor}}
function _checkOrientation(b,d){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(b>d?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function createBitmap(b,d,e){var f=new createjs.Bitmap(b),m=new createjs.Shape;d&&e?m.graphics.beginFill("#fff").drawRect(0,0,d,e):m.graphics.beginFill("#ff0").drawRect(0,0,b.width,b.height);f.hitArea=m;return f}function createSprite(b,d,e,f,m,n){b=null!==d?new createjs.Sprite(b,d):new createjs.Sprite(b);d=new createjs.Shape;d.graphics.beginFill("#000000").drawRect(-e,-f,m,n);b.hitArea=d;return b}
function randomFloatBetween(b,d,e){"undefined"===typeof e&&(e=2);return parseFloat(Math.min(b+Math.random()*(d-b),d).toFixed(e))}function shuffle(b){for(var d=b.length,e,f;0!==d;)f=Math.floor(Math.random()*d),--d,e=b[d],b[d]=b[f],b[f]=e;return b}function formatTime(b){b/=1E3;var d=Math.floor(b/60);b=parseFloat(b-60*d).toFixed(1);var e="";e=10>d?e+("0"+d+":"):e+(d+":");return 10>b?e+("0"+b):e+b}
function NoClickDelay(b){this.element=b;window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(b){for(var d=b.length,e,f;0<d;)f=Math.floor(Math.random()*d),d--,e=b[d],b[d]=b[f],b[f]=e;return b}
NoClickDelay.prototype={handleEvent:function(b){switch(b.type){case "touchstart":this.onTouchStart(b);break;case "touchmove":this.onTouchMove(b);break;case "touchend":this.onTouchEnd(b)}},onTouchStart:function(b){b.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(b){this.moved=!0},onTouchEnd:function(b){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){b=document.elementFromPoint(b.changedTouches[0].clientX,b.changedTouches[0].clientY);3==b.nodeType&&(b=b.parentNode);var d=document.createEvent("MouseEvents");d.initEvent("click",!0,!0);b.dispatchEvent(d)}}};
(function(){function b(e){var f={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};e=e||window.event;e.type in f?document.body.className=f[e.type]:(document.body.className=this[d]?"hidden":"visible","hidden"===document.body.className?(s_oMain.stopUpdate(),s_bFocus=!1):(s_oMain.startUpdate(),s_bFocus=!0))}var d="hidden";d in document?document.addEventListener("visibilitychange",b):(d="mozHidden")in document?document.addEventListener("mozvisibilitychange",
b):(d="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",b):(d="msHidden")in document?document.addEventListener("msvisibilitychange",b):"onfocusin"in document?document.onfocusin=document.onfocusout=b:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=b})();function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}
function getParamValue(b){for(var d=window.location.search.substring(1).split("&"),e=0;e<d.length;e++){var f=d[e].split("=");if(f[0]==b)return f[1]}}function playSound(b,d,e){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[b].play(),s_aSounds[b].volume(d),s_aSounds[b].loop(e),s_aSounds[b]):null}function stopSound(b){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[b].stop()}function setVolume(b,d){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[b].volume(d)}
function setMute(b,d){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[b].mute(d)}function saveItem(b,d){s_bStorageAvailable&&localStorage.setItem(b,d)}function getItem(b){return s_bStorageAvailable?localStorage.getItem(b):null}
function fullscreenHandler(){ENABLE_FULLSCREEN&&!1!==screenfull.isEnabled&&(s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oLevelMenu&&s_oLevelMenu.resetFullscreenBut())}if(screenfull.isEnabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut();null!==s_oLevelMenu&&s_oLevelMenu.resetFullscreenBut()});
function CSpriteLibrary(){var b={},d,e,f,m,n,h;this.init=function(g,c,q){d={};f=e=0;m=g;n=c;h=q};this.addSprite=function(g,c){if(!b.hasOwnProperty(g)){var q=new Image;b[g]=d[g]={szPath:c,oSprite:q,bLoaded:!1};e++}};this.getSprite=function(g){return b.hasOwnProperty(g)?b[g].oSprite:null};this._onSpritesLoaded=function(){e=0;n.call(h)};this._onSpriteLoaded=function(){m.call(h);++f===e&&this._onSpritesLoaded()};this.loadSprites=function(){for(var g in d)d[g].oSprite.oSpriteLibrary=this,d[g].oSprite.szKey=
g,d[g].oSprite.onload=function(){this.oSpriteLibrary.setLoaded(this.szKey);this.oSpriteLibrary._onSpriteLoaded(this.szKey)},d[g].oSprite.onerror=function(c){var q=c.currentTarget;setTimeout(function(){d[q.szKey].oSprite.src=d[q.szKey].szPath},500)},d[g].oSprite.src=d[g].szPath};this.setLoaded=function(g){b[g].bLoaded=!0};this.isLoaded=function(g){return b[g].bLoaded};this.getNumSprites=function(){return e}}
var CANVAS_WIDTH=960,CANVAS_HEIGHT=540,EDGEBOARD_X=128,EDGEBOARD_Y=42,FPS=35,FPS_TIME=1E3/FPS,DISABLE_SOUND_MOBILE=!1,FONT_GAME="Chewy",STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_MSG_BOX_LEFT_BUT=6,ON_MSG_BOX_CENTER_BUT=7,ON_MSG_BOX_RIGHT_BUT=8,STATE_GAME_ROLL_IN=0,STATE_GAME_BALL_MOVE=1,STATE_GAME_ROLL_OUT=2,STATE_GAME_SHOOTING=3,STATE_GAME_ATTRACT_BALLS=4,PATH_COLOR_STROKE="#a04c00",PATH_COLOR=
"#221910",STEP_LENGTH=1.8,BALL_COLORS=5,BALL_ROLLING_IN,BALL_SHOOTED_SPEED=24,NUM_LEVELS,COMBO_VALUE,EXTRA_SCORE,BALL_DIAMETER,BALL_RADIUS,BALL_DIAMETER_SQUARE,NUM_ROWS_PAGE_LEVEL=3,NUM_COLS_PAGE_LEVEL=5,SOUNDTRACK_VOLUME_IN_GAME=1,ENABLE_FULLSCREEN,ENABLE_CHECK_ORIENTATION;
function CPreloader(){var b,d,e,f,m,n,h,g,c;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg");s_oSpriteLibrary.loadSprites();c=new createjs.Container;s_oStage.addChild(c)};this.unload=function(){c.removeAllChildren()};this._onImagesLoaded=function(){};this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};
this.attachSprites=function(){var q=new createjs.Shape;q.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);c.addChild(q);q=s_oSpriteLibrary.getSprite("200x200");h=createBitmap(q);h.regX=.5*q.width;h.regY=.5*q.height;h.x=CANVAS_WIDTH/2;h.y=CANVAS_HEIGHT/2-150;c.addChild(h);g=new createjs.Shape;g.graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(h.x-100,h.y-100,200,200,10);c.addChild(g);h.mask=g;q=s_oSpriteLibrary.getSprite("progress_bar");f=createBitmap(q);f.x=CANVAS_WIDTH/2-
q.width/2;f.y=CANVAS_HEIGHT/2+50;c.addChild(f);b=q.width;d=q.height;m=new createjs.Shape;m.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(f.x,f.y,1,d);c.addChild(m);f.mask=m;e=new createjs.Text("","30px "+FONT_GAME,"#fff");e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT/2+100;e.textBaseline="alphabetic";e.textAlign="center";c.addChild(e);n=new createjs.Shape;n.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);c.addChild(n);createjs.Tween.get(n).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(n);
c.removeChild(n)})};this.refreshLoader=function(q){e.text=q+"%";100===q&&(s_oMain._onRemovePreloader(),e.visible=!1,f.visible=!1);m.graphics.clear();q=Math.floor(q*b/100);m.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(f.x,f.y,q,d)};this._init()}
function CMain(b){var d,e=0,f=0,m=STATE_LOADING,n,h;this.initContainer=function(){var c=document.getElementById("canvas");s_oStage=new createjs.Stage(c);s_bMobile=isMobile();!1===s_bMobile?s_oStage.enableMouseOver(20):createjs.Touch.enable(s_oStage,!0);s_iPrevTime=(new Date).getTime();createjs.Ticker.framerate=FPS;createjs.Ticker.on("tick",this._update);navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;n=new CPreloader};this.setLocalStorageLevel=
function(c){s_iLastLevel<c&&(s_iLastLevel=c,saveItem("sorcerer_level",s_iLastLevel))};this.setLocalStorageScore=function(c,q,u){saveItem("score_level_"+u,c)};this.clearLocalStorage=function(){s_iLastLevel=1;s_bStorageAvailable&&localStorage.clear()};this.getScoreTillLevel=function(c){if(!s_bStorageAvailable)return 0;for(var q=0,u=0;u<c-1;u++)q+=parseInt(getItem("score_level_"+(u+1)));return q};this.preloaderReady=function(){this._loadImages();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();
d=!0};this.soundLoaded=function(){e++;n.refreshLoader(Math.floor(e/f*100))};this._initSounds=function(){Howler.mute(!s_bAudioActive);s_aSoundsInfo=[];s_aSoundsInfo.push({path:"./sounds/",filename:"win",loop:!1,volume:1,ingamename:"win"});s_aSoundsInfo.push({path:"./sounds/",filename:"press_but",loop:!1,volume:1,ingamename:"press_but"});s_aSoundsInfo.push({path:"./sounds/",filename:"game_over",loop:!1,volume:1,ingamename:"game_over"});s_aSoundsInfo.push({path:"./sounds/",filename:"combo",loop:!1,volume:1,
ingamename:"combo"});s_aSoundsInfo.push({path:"./sounds/",filename:"shot",loop:!1,volume:1,ingamename:"shot"});s_aSoundsInfo.push({path:"./sounds/",filename:"soundtrack",loop:!0,volume:1,ingamename:"soundtrack"});f+=s_aSoundsInfo.length;s_aSounds=[];for(var c=0;c<s_aSoundsInfo.length;c++)this.tryToLoadSound(s_aSoundsInfo[c],!1)};this.tryToLoadSound=function(c,q){setTimeout(function(){s_aSounds[c.ingamename]=new Howl({src:[c.path+c.filename+".mp3"],autoplay:!1,preload:!0,loop:c.loop,volume:c.volume,
onload:s_oMain.soundLoaded,onloaderror:function(u,v){for(var w=0;w<s_aSoundsInfo.length;w++)if(u===s_aSounds[s_aSoundsInfo[w].ingamename]._sounds[0]._id){s_oMain.tryToLoadSound(s_aSoundsInfo[w],!0);break}},onplayerror:function(u){for(var v=0;v<s_aSoundsInfo.length;v++)if(u===s_aSounds[s_aSoundsInfo[v].ingamename]._sounds[0]._id){s_aSounds[s_aSoundsInfo[v].ingamename].once("unlock",function(){s_aSounds[s_aSoundsInfo[v].ingamename].play();"soundtrack"===s_aSoundsInfo[v].ingamename&&null!==s_oGame&&
setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)});break}}})},q?200:0)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("but_bg","./sprites/but_play_bg.png");s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png");s_oSpriteLibrary.addSprite("but_continue","./sprites/but_continue.png");s_oSpriteLibrary.addSprite("but_generic_small","./sprites/but_generic_small.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");
s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("hero","./sprites/hero.png");s_oSpriteLibrary.addSprite("hit_area","./sprites/hit_area.png");s_oSpriteLibrary.addSprite("explosion","./sprites/explosion.png");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("extra_score","./sprites/extra_score.png");s_oSpriteLibrary.addSprite("end_path","./sprites/end_path.png");
s_oSpriteLibrary.addSprite("but_level","./sprites/but_level.png");s_oSpriteLibrary.addSprite("bg_menu_level","./sprites/bg_menu_level.jpg");s_oSpriteLibrary.addSprite("arrow_left","./sprites/arrow_left.png");s_oSpriteLibrary.addSprite("arrow_right","./sprites/arrow_right.png");s_oSpriteLibrary.addSprite("logo_ctl","./sprites/logo_ctl.png");s_oSpriteLibrary.addSprite("but_credits","./sprites/but_credits.png");s_oSpriteLibrary.addSprite("but_exit_small","./sprites/but_exit_small.png");s_oSpriteLibrary.addSprite("but_fullscreen",
"./sprites/but_fullscreen.png");for(var c=0;c<BALL_COLORS;c++)s_oSpriteLibrary.addSprite("ball_"+c,"./sprites/ball_"+c+".png");s_oSpriteLibrary.addSprite("bg_game_1","./sprites/bg_game_1.jpg");s_oSpriteLibrary.addSprite("bg_game_2","./sprites/bg_game_2.jpg");s_oSpriteLibrary.addSprite("bg_game_3","./sprites/bg_game_3.jpg");s_oSpriteLibrary.addSprite("bg_game_4","./sprites/bg_game_4.jpg");f+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){e++;n.refreshLoader(Math.floor(e/
f*100))};this._onAllImagesLoaded=function(){};this._onRemovePreloader=function(){n.unload();this.onLoadedJSON(LEVELS)};this.onLoadedJSON=function(c){try{saveItem("ls_available","ok")}catch(q){s_bStorageAvailable=!1}s_oLevelSettings=new CLevelSettings(c);playSound("soundtrack",1,!0);s_oMain.gotoMenu()};this.stopUpdate=function(){d=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||Howler.mute(!0)};this.startUpdate=function(){s_iPrevTime=
(new Date).getTime();d=!0;createjs.Ticker.paused=!1;$("#block_game").css("display","none");(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)&&s_bAudioActive&&Howler.mute(!1)};this.gotoMenu=function(){new CMenu;m=STATE_MENU};this.gotoLevelMenu=function(){new CLevelMenu};this.gotoGame=function(c,q){h=new CGame(g,c,q);m=STATE_GAME};this.gotoHelp=function(){new CHelp;m=STATE_HELP};this.levelSelected=function(c){c>=s_iLastLevel&&(s_iLastLevel=c);var q=this.getScoreTillLevel(c);this.gotoGame(c,q)};this._update=
function(c){if(!1!==d){var q=(new Date).getTime();s_iTimeElaps=q-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=q;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);m===STATE_GAME&&h.update();void 0!==s_oStage&&s_oStage.update(c)}};s_oMain=this;var g=b;ENABLE_FULLSCREEN=b.fullscreen;ENABLE_CHECK_ORIENTATION=b.check_orientation;s_bAudioActive=b.audio_enable_on_startup;this.initContainer()}
var s_bMobile,s_bAudioActive=!1,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oDrawLayer,s_oStage,s_oMain=null,s_oSpriteLibrary,s_oLevelSettings,s_iLastLevel=1,s_bFullscreen=!1,s_bStorageAvailable=!0,s_aSounds,s_aSoundsInfo;
function CTextButton(b,d,e,f,m,n,h,g){var c,q,u,v,w,z,F,A,H,K;this._init=function(r,x,p,l,B,I,C){c=!1;q=1;u=[];v=[];K=createBitmap(p);A=new createjs.Container;A.x=r;A.y=x;A.regX=p.width/2;A.regY=p.height/2;s_bMobile||(A.cursor="pointer");A.addChild(K,H);g.addChild(A);H=new CTLText(A,10,12,p.width-20,p.height-20,C,"center",I,B,1.1,0,0,l,!0,!0,!1,!1);this._initListener()};this.unload=function(){A.off("mousedown",w);A.off("pressup",z);g.removeChild(A)};this.setVisible=function(r){A.visible=r};this.setAlign=
function(r){H.textAlign=r};this.setTextX=function(r){H.x=r};this.setScale=function(r){q=A.scaleX=A.scaleY=r};this.enable=function(){c=!1};this.disable=function(){c=!0};this._initListener=function(){w=A.on("mousedown",this.buttonDown);z=A.on("pressup",this.buttonRelease)};this.addEventListener=function(r,x,p){u[r]=x;v[r]=p};this.addEventListenerWithParams=function(r,x,p,l){u[r]=x;v[r]=p;F=l};this.buttonRelease=function(){c||(playSound("press_but",1,!1),A.scaleX=q,A.scaleY=q,u[ON_MOUSE_UP]&&u[ON_MOUSE_UP].call(v[ON_MOUSE_UP],
F))};this.buttonDown=function(){c||(A.scaleX=.9*q,A.scaleY=.9*q,u[ON_MOUSE_DOWN]&&u[ON_MOUSE_DOWN].call(v[ON_MOUSE_DOWN]))};this.setPosition=function(r,x){A.x=r;A.y=x};this.tweenPosition=function(r,x,p,l,B,I,C){createjs.Tween.get(A).wait(l).to({x:r,y:x},p,B).call(function(){void 0!==I&&I.call(C)})};this.changeText=function(r){H.refreshText(r)};this.setX=function(r){A.x=r};this.setY=function(r){A.y=r};this.getButtonImage=function(){return A};this.getX=function(){return A.x};this.getY=function(){return A.y};
this.getSprite=function(){return A};this.getScale=function(){return A.scaleX};this._init(b,d,e,f,m,n,h)}
function CGfxButton(b,d,e){var f,m,n=[],h,g,c;this._init=function(q,u,v){f=[];m=[];c=createBitmap(v);c.x=q;c.y=u;c.regX=v.width/2;c.regY=v.height/2;c.cursor="pointer";s_oStage.addChild(c);this._initListener()};this.unload=function(){c.off("mousedown",h);c.off("pressup",g);s_oStage.removeChild(c)};this.setVisible=function(q){c.visible=q};this._initListener=function(){h=c.on("mousedown",this.buttonDown);g=c.on("pressup",this.buttonRelease)};this.addEventListener=function(q,u,v){f[q]=u;m[q]=v};this.addEventListenerWithParams=
function(q,u,v,w){f[q]=u;m[q]=v;n=w};this.buttonRelease=function(){playSound("press_but",1,!1);c.scaleX=1;c.scaleY=1;f[ON_MOUSE_UP]&&f[ON_MOUSE_UP].call(m[ON_MOUSE_UP],n)};this.buttonDown=function(){c.scaleX=.9;c.scaleY=.9;f[ON_MOUSE_DOWN]&&f[ON_MOUSE_DOWN].call(m[ON_MOUSE_DOWN],n)};this.setPosition=function(q,u){c.x=q;c.y=u};this.setX=function(q){c.x=q};this.setY=function(q){c.y=q};this.getButtonImage=function(){return c};this.getX=function(){return c.x};this.getY=function(){return c.y};this._init(b,
d,e);return this}
function CToggle(b,d,e,f){var m,n,h,g,c,q;this._init=function(u,v,w,z){n=[];h=[];var F=new createjs.SpriteSheet({images:[w],frames:{width:w.width/2,height:w.height,regX:w.width/2/2,regY:w.height/2},animations:{state_true:[0],state_false:[1]}});m=z;q=createSprite(F,"state_"+m,w.width/2/2,w.height/2,w.width/2,w.height);q.x=u;q.y=v;q.stop();q.cursor="pointer";s_oStage.addChild(q);this._initListener()};this.unload=function(){q.off("mousedown",g);q.off("pressup",c);s_oStage.removeChild(q)};this._initListener=
function(){g=q.on("mousedown",this.buttonDown);c=q.on("pressup",this.buttonRelease)};this.addEventListener=function(u,v,w){n[u]=v;h[u]=w};this.setActive=function(u){m=u;q.gotoAndStop("state_"+m)};this.buttonRelease=function(){q.scaleX=1;q.scaleY=1;playSound("press_but",1,!1);m=!m;q.gotoAndStop("state_"+m);n[ON_MOUSE_UP]&&n[ON_MOUSE_UP].call(h[ON_MOUSE_UP],m)};this.buttonDown=function(){q.scaleX=.9;q.scaleY=.9;n[ON_MOUSE_DOWN]&&n[ON_MOUSE_DOWN].call(h[ON_MOUSE_DOWN])};this.setPosition=function(u,v){q.x=
u;q.y=v};this._init(b,d,e,f)}
function CMenu(){var b,d,e,f,m,n,h,g,c=null,q,u,v,w,z=null,F=null;this._init=function(){h=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(h);if(s_bStorageAvailable){var A=getItem("sorcerer_level");null!==A&&void 0!==A?s_iLastLevel=parseInt(getItem("sorcerer_level")):saveItem("sorcerer_level",1)}else new CAlertSavingBox(TEXT_ERR_LS,s_oStage);1===s_iLastLevel?(g=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT-120,s_oSpriteLibrary.getSprite("but_play"),!0),g.addEventListener(ON_MOUSE_UP,
this._onButPlayRelease,this)):(g=new CGfxButton(CANVAS_WIDTH/2-150,CANVAS_HEIGHT-120,s_oSpriteLibrary.getSprite("but_play"),!0),g.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this),c=new CGfxButton(CANVAS_WIDTH/2+150,CANVAS_HEIGHT-120,s_oSpriteLibrary.getSprite("but_continue"),!0),c.addEventListener(ON_MOUSE_UP,this._onButContinueRelease,this));if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)A=s_oSpriteLibrary.getSprite("audio_icon"),m=CANVAS_WIDTH-A.height/2-6,n=A.height/2+6,q=new CToggle(m,
n,A,s_bAudioActive),q.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);A=s_oSpriteLibrary.getSprite("but_credits");e=A.width/2+6;f=A.height/2+6;u=new CGfxButton(e,f,A,s_oStage);u.addEventListener(ON_MOUSE_UP,this._onButCreditsRelease,this);A=window.document;var H=A.documentElement;z=H.requestFullscreen||H.mozRequestFullScreen||H.webkitRequestFullScreen||H.msRequestFullscreen;F=A.exitFullscreen||A.mozCancelFullScreen||A.webkitExitFullscreen||A.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(z=!1);
z&&screenfull.isEnabled&&(A=s_oSpriteLibrary.getSprite("but_fullscreen"),b=e+A.width/2,d=f,w=new CToggle(b,d,A,s_bFullscreen,s_oStage),w.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));v=new createjs.Shape;v.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(v);createjs.Tween.get(v).to({alpha:0},400).call(function(){v.visible=!1});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){g.unload();g=null;u.unload();null!==c&&c.unload();
if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)q.unload(),q=null;z&&screenfull.isEnabled&&w.unload();s_oStage.removeChild(h);h=null;s_oStage.removeChild(v);s_oMenu=v=null};this.refreshButtonPos=function(A,H){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||q.setPosition(m-A,H+n);z&&screenfull.isEnabled&&w.setPosition(b+A,d+H);u.setPosition(e+A,f+H)};this._exitFromMenu=function(){this.unload();s_oMain.gotoLevelMenu();$(s_oMain).trigger("start_session")};this._onButPlayRelease=function(){if(1<s_iLastLevel){var A=
new CMsgBox(TEXT_DELETE_SAVINGS,TEXT_NO,"",TEXT_YES);A.addEventListener(ON_MSG_BOX_LEFT_BUT,function(){A.hide()},this);A.addEventListener(ON_MSG_BOX_RIGHT_BUT,function(){A.hide();s_oMain.clearLocalStorage();s_oMenu._exitFromMenu()},this)}else s_oMenu._exitFromMenu()};this._onButContinueRelease=function(){s_oMenu._exitFromMenu()};this._onButCreditsRelease=function(){new CCreditsPanel};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this.resetFullscreenBut=
function(){z&&screenfull.isEnabled&&w.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?F.call(window.document):z.call(window.document.documentElement);sizeHandler()};s_oMenu=this;this._init()}var s_oMenu=null;
function CGame(b,d,e){var f=!1,m,n,h,g,c,q,u,v,w=-1,z,F,A,H,K,r,x,p,l,B,I,C=null,X=null,R=null,N,Q,V,Z,Y,aa,S;this._init=function(k,a){x=k;g=a;s_oBezier=new CBezier;S=new createjs.Container;Q=createBitmap(s_oSpriteLibrary.getSprite(s_oLevelSettings.getBgForLevel(x)));S.addChild(Q);s_oStage.addChild(S);Q.cache(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);N=new CHero;Y=new createjs.Container;Z=new createjs.Container;aa=new createjs.Container;s_oStage.addChild(Y);s_oStage.addChild(Z);s_oStage.addChild(aa);V=new CInterface(g);
this.reset();if(!1===s_bMobile){var y=this;s_oStage.addEventListener("stagemousemove",function(t){y._onMouseMove(t.stageX,t.stageY)})}f=!0};this.unload=function(){f=!1;clearInterval(A);V.unload();N.unload();s_oStage.removeAllChildren()};this.reset=function(){m=!0;h=n=!1;v=s_oLevelSettings.getBallSpeedForLevel(x);u=s_oLevelSettings.getBallNumberForLevel(x);K=s_oLevelSettings.getBallColorsForLevel(x);BALL_ROLLING_IN=Math.floor(.33*u);z=0;q=F=1;c=r=0;N.reset(s_oLevelSettings.getHeroPosForLevel(x),K);
null!==X&&(Y.removeChild(X),Y.removeChild(R));this._initCurve();this._initBall();V.refreshLevel(x);$(s_oMain).trigger("start_level",x)};this._normalize=function(k){var a=this._length(k);return 0<a?{x:k.x/a,y:k.y/a}:k};this._length=function(k){return Math.sqrt(k.x*k.x+k.y*k.y)};this._dotProductV2=function(k,a){return k.x*a.x+k.y*a.y};this._angleBetweenVectors=function(k,a){var y=Math.acos(this._dotProductV2(k,a)/(this._length(k)*this._length(a)));return!0===isNaN(y)?0:y};this._rot90CW=function(k){return{x:k.y,
y:-k.x}};this._rot90CCW=function(k){return{x:-k.y,y:k.x}};this._rotateVector2D=function(k,a){return{x:a.x*Math.cos(k)+a.y*Math.sin(k),y:a.x*-Math.sin(k)+a.y*Math.cos(k)}};this._initCurve=function(){var k;var a=s_oLevelSettings.getCurveForLevel(x);var y=new createjs.Graphics;l=[];for(k=0;k<a.length-2;++k){var t=0===k?new createjs.Point(a[0][0],a[0][1]):new createjs.Point((a[k][0]+a[k+1][0])/2,(a[k][1]+a[k+1][1])/2),G=new createjs.Point(a[k+1][0],a[k+1][1]),J=k<=a.length-4?new createjs.Point((a[k+1][0]+
a[k+2][0])/2,(a[k+1][1]+a[k+2][1])/2):new createjs.Point(a[k+2][0],a[k+2][1]);t=s_oBezier.init(t,G,J,STEP_LENGTH);for(G=1;G<=t;++G)J=s_oBezier.getAnchorPoint(G),l.push(J)}y.setStrokeStyle(4);y.beginStroke(PATH_COLOR_STROKE);y.beginFill(PATH_COLOR);t={x:l[1][0]-l[0][0],y:l[1][1]-l[0][1]};t=this._normalize(t);t=this._rot90CW(t);t.x*=15;t.y*=15;t.x+=l[0][0];t.y+=l[0][1];a=t.x;k=t.y;y.moveTo(t.x,t.y);for(G=1;G<l.length-1;G++)t={x:l[G+1][0]-l[G][0],y:l[G+1][1]-l[G][1]},t=this._normalize(t),t=this._rot90CW(t),
t.x*=15,t.y*=15,t.x+=l[G][0],t.y+=l[G][1],y.lineTo(t.x,t.y);y.lineTo(t.x,t.y);t={x:l[l.length-1][0]-l[l.length-2][0],y:l[l.length-1][1]-l[l.length-2][1]};t=this._normalize(t);t=this._rot90CCW(t);t.x*=15;t.y*=15;t.x+=l[l.length-1][0];t.y+=l[l.length-1][1];y.lineTo(t.x,t.y);for(G=l.length-2;1<G;G--)t={x:l[G][0]-l[G-1][0],y:l[G][1]-l[G-1][1]},t=this._normalize(t),t=this._rot90CCW(t),t.x*=15,t.y*=15,t.x+=l[G][0],t.y+=l[G][1],y.lineTo(t.x,t.y);y.lineTo(a,k);y.endFill();X=new createjs.Shape(y);Y.addChild(X);
y=l.length;a=s_oSpriteLibrary.getSprite("end_path");R=createBitmap(a);R.x=l[y-9][0];R.y=l[y-9][1];R.regX=a.width/2;R.regY=a.height/2;Y.addChild(R);Y.cache(0,0,CANVAS_WIDTH,CANVAS_HEIGHT)};this._initBall=function(){p=[];var k=this.getRandomBall();p.unshift(k);k.setPos(16,l);w=STATE_GAME_ROLL_IN};this.getRandomBall=function(){u--;return new CBall(Math.floor(Math.random()*K),Z)};this._pushNextBall=function(k,a){var y=[];y.push(p[k]);for(var t=k;t<p.length-1;++t)if(16>=p[t+1].getFotogram()-p[t].getFotogram())16>
p[t+1].getFotogram()-p[t].getFotogram()&&p[t+1].setPos(p[t].getFotogram()+16,l),y.push(p[t+1]);else break;for(t=0;t<y.length;++t)y[t].increasePos(a,l);if(p[p.length-1].getFotogram()>=l.length-17){m=!1;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)if(s_aSounds.soundtrack.pause(),y=playSound("game_over",1,!1))y.on("end",this._onSoundGameOverComplete);s_oStage.removeEventListener("stagemousemove");h=n=!1;q=1;p[p.length-1].unload();p.splice(p.length-1,1);w=STATE_GAME_ROLL_OUT}};this.onIntroduceBall=function(){if(0!==
p.length&&(s_oGame._pushNextBall(0,1),32===p[0].getFotogram()&&0!==u)){var k=s_oGame.getRandomBall();p.unshift(k);k.setPos(16,l)}};this.shoot=function(){playSound("shot",1,!1);var k=(N.getRotation()+90)*Math.PI/180,a=N.getCurrentBall();a.changePos(N.getX()+60*Math.cos(k),N.getY()+60*Math.sin(k));Z.addChild(a.getSprite());a.setContainer(Z);B.push([a,k]);w=STATE_GAME_SHOOTING};this._checkCollision=function(k){k=k[0];for(var a=0;a<p.length;++a)if((p[a].getX()-k.getX())*(p[a].getX()-k.getX())+(p[a].getY()-
k.getY())*(p[a].getY()-k.getY())<=BALL_DIAMETER_SQUARE)return a;return-1};this._insertBall=function(k,a,y){if("next"===y){var t=p[a].getFotogram()+16;p[a+1]&&32>p[a+1].getFotogram()-p[a].getFotogram()&&(I.push([k,p[a+1]]),n=!0)}else p[a-1]&&32>p[a].getFotogram()-p[a-1].getFotogram()?(t=p[a-1].getFotogram()+16,I.push([k,p[a]]),n=!0):t=p[a].getFotogram()-16;a=l[t][0];y=l[t][1];var G=this;createjs.Tween.get(k.getSprite()).to({x:a,y:y},200).call(function(){G.motionFinished(k,t)})};this.motionFinished=
function(k,a){for(var y,t=0;t<p.length;++t){if(p[t].getFotogram()>a){y=t;break}t===p.length-1&&(y=t+1)}I.splice(I.indexOf(k),1);k.setPos(a,l);p.splice(y,0,k);p[y-1]&&p[y-1].getIndex()===p[y].getIndex()&&17<p[y].getFotogram()-p[y-1].getFotogram()&&this._addToBallAttracted(p[y]);p[y+1]&&p[y+1].getIndex()===p[y].getIndex()&&17<p[y+1].getFotogram()-p[y].getFotogram()&&this._addToBallAttracted(p[y+1]);this._clearCheck(y,!0)};this._addToBallAttracted=function(k){null===C&&(C=[]);C.push(k);setTimeout(function(){h=
!0},400)};this._clearCheck=function(k,a){var y=[];y.push(p[k]);for(var t=p[k].getIndex(),G=k+1;p[G];)if(p[G].getIndex()===t)if(17>=p[G].getFotogram()-p[G-1].getFotogram())y.push(p[G]),++G;else if(a)break;else y.push(p[G]),++G;else break;for(G=k-1;p[G];)if(p[G].getIndex()===t)if(17>=p[G+1].getFotogram()-p[G].getFotogram())y.push(p[G]),--G;else if(a)break;else y.push(p[G]),--G;else break;++G;2<y.length&&a&&this._clearBall(G,y);return y.length};this._attract=function(){if(0!==C.length)for(var k=0;k<
C.length;++k){var a=p.indexOf(C[k]);if(-1!==a&&p[a-1])if(C[k].getIndex()===p[a-1].getIndex()){var y=19<C[k].getFotogram()-p[a-1].getFotogram()?3:C[k].getFotogram()-p[a-1].getFotogram()-16;this._pushNextBall(a,-y);16>=C[k].getFotogram()-p[a-1].getFotogram()&&(q++,C.splice(k,1),this._clearCheck(a-1,!0),0===C.length&&(h=!1,q=1))}else C.splice(k,1),z>F&&(F=z),z=0}else h=!1,q=1};this._checkPushCollision=function(){if(0!==I.length)for(var k=0;k<I.length;++k){var a=(I[k][0].getX()-I[k][1].getX())*(I[k][0].getX()-
I[k][1].getX())+(I[k][0].getY()-I[k][1].getY())*(I[k][0].getY()-I[k][1].getY());a=a<BALL_DIAMETER_SQUARE?!0:!1;for(var y=0;a;)++y,a=(I[k][0].getX()-l[I[k][1].getFotogram()+y][0])*(I[k][0].getX()-l[I[k][1].getFotogram()+y][0])+(I[k][0].getY()-l[I[k][1].getFotogram()+y][1])*(I[k][0].getY()-l[I[k][1].getFotogram()+y][1]),a=a<BALL_DIAMETER_SQUARE?!0:!1;a=p.indexOf(I[k][1]);-1!==a&&this._pushNextBall(a,y)}else n=!1};this._clearBall=function(k,a){++z;playSound("combo",1,!1);for(var y=0,t=0;t<a.length;++t)a[t].explode(),
y+=COMBO_VALUE;y*=q;g+=y;c+=y;V.refreshScore(g);if(p.length===a.length&&(m=!1,H=p[p.length-1].getFotogram(),setTimeout(this._gamePass,600),!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)&&(s_aSounds.soundtrack.pause(),y=playSound("win",1,!1)))y.on("end",this._onSoundGameOverComplete);p.splice(k,a.length);0===u&&this._checkColor(a[0].getIndex());p[k-1]&&p[k]&&p[k-1].getIndex()===p[k].getIndex()?(3>this._clearCheck(k,!1)&&(z>F&&(F=z),z=0),this._addToBallAttracted(p[k])):(z>F&&(F=z),z=0)};this._gamePass=
function(){A=setInterval(s_oGame._extraScore,v)};this._extraScore=function(){H+16<l.length-17?(H+=16,new CExtraScore(l[H][0],l[H][1],aa),g+=EXTRA_SCORE,c+=EXTRA_SCORE,V.refreshScore(g)):($(s_oMain).trigger("end_level",x),clearInterval(A),s_oStage.removeEventListener("stagemousemove"),m=!1,s_oMain.setLocalStorageScore(c,g,x),x++,x>s_oLevelSettings.getNumLevels()?(x--,V.win(g)):(s_oMain.setLocalStorageLevel(x),V.nextLevel(x,g)))};this._checkColor=function(k){for(var a=0;a<p.length;++a)if(p[a].getIndex()===
k)return;for(a=0;a<B.length;++a)if(B[a][0].getIndex()===k){B[a][0].unload();return}N.colorCleared(k)};this.nextLevel=function(){S.removeChild(Q);Q=createBitmap(s_oSpriteLibrary.getSprite(s_oLevelSettings.getBgForLevel(x)));S.addChild(Q);this.reset();f=!0};this.onShot=function(k,a){if(m&&N.canShoot()){if(s_bMobile){var y=k-N.getX()*s_iScaleFactor,t=a-N.getY()*s_iScaleFactor;N.rotate(180*Math.atan2(t,y)/Math.PI-90)}this.shoot()}};this._onMouseMove=function(k,a){var y=k-N.getX()*s_iScaleFactor,t=a-N.getY()*
s_iScaleFactor;N.rotate(180*Math.atan2(t,y)/Math.PI-90)};this.onExit=function(){this.unload();s_oMain.gotoMenu();$(s_oMain).trigger("end_session");$(s_oMain).trigger("share_event",g)};this._onSoundGameOverComplete=function(){playSound("soundtrack",1,!0)};this._updateMove=function(){r+=s_iTimeElaps;r>v&&(r=0,this.onIntroduceBall())};this._updateRollOut=function(){for(var k=p.length-1;0<=k;--k)p[k].getFotogram()>l.length-17?(p[k].unload(),p.splice(k,1),0===p.length&&(w=-1,V.gameOver(g))):p[k].increasePos(8,
l)};this._updateRollIn=function(){if(p.length<BALL_ROLLING_IN){for(var k=0;k<p.length;++k)p[k].increasePos(4,l);32===p[0].getFotogram()&&(k=this.getRandomBall(),p.unshift(k),k.setPos(16,l))}else w=-1,B=[],I=[],N.start(),w=STATE_GAME_BALL_MOVE};this._updateShooting=function(){if(0!==B.length)for(var k=0;k<B.length;++k)if(0<B[k][0].getX()&&B[k][0].getX()<CANVAS_WIDTH&&0<B[k][0].getY()&&B[k][0].getY()<CANVAS_HEIGHT){var a=this._checkCollision(B[k]);if(-1===a)B[k][0].increasePosWithNumbers(Math.cos(B[k][1])*
BALL_SHOOTED_SPEED,Math.sin(B[k][1])*BALL_SHOOTED_SPEED);else{var y=B[k][0],t=B[k][1],G=Math.sqrt((p[a].getX()-y.getX())*(p[a].getX()-y.getX())+(p[a].getY()-y.getY())*(p[a].getY()-y.getY()));B[k][0].decreasePos((BALL_DIAMETER-G)*Math.cos(t),(BALL_DIAMETER-G)*Math.sin(t));t=l[p[a].getFotogram()-BALL_RADIUS][0];G=l[p[a].getFotogram()-BALL_RADIUS][1];t=Math.sqrt((y.getX()-t)*(y.getX()-t)+(y.getY()-G)*(y.getY()-G));G=l[p[a].getFotogram()+BALL_RADIUS][0];var J=l[p[a].getFotogram()+BALL_RADIUS][1];y=Math.sqrt((y.getX()-
G)*(y.getX()-G)+(y.getY()-J)*(y.getY()-J));this._insertBall(B[k][0],a,t>y?"next":"previous");B.splice(k,1)}}else B[k][0].unload(),B.splice(k,1);else w=-1};this.update=function(){if(!1!==f)switch(!0===h&&this._attract(),!0===n&&this._checkPushCollision(),w){case STATE_GAME_ROLL_IN:this._updateRollIn();break;case STATE_GAME_ROLL_OUT:this._updateRollOut();break;case STATE_GAME_SHOOTING:this._updateShooting();this._updateMove();break;default:this._updateMove()}};s_oGame=this;COMBO_VALUE=b.combo_value;
EXTRA_SCORE=b.extra_score;this._init(d,e)}var s_oGame,s_oBezier;
function CInterface(b){var d,e,f,m,n,h,g,c,q,u,v,w,z,F,A,H,K,r,x=null,p=null;this._init=function(l){c=g=10;w=new createjs.Text(TEXT_SCORE+" "+l,"38px "+FONT_GAME,"#fff");w.x=g;w.y=c;w.textAlign="left";s_oStage.addChild(w);n=10;h=50;v=new createjs.Text(TEXT_LEVEL+" "+s_iLastLevel,"30px "+FONT_GAME,"#fff");v.x=n;v.y=h;v.textAlign="left";s_oStage.addChild(v);var B=this;F=createBitmap(s_oSpriteLibrary.getSprite("hit_area"));s_oStage.addChild(F);F.on("pressup",function(C){B._onTapScreen(C.stageX,C.stageY)});
l=s_oSpriteLibrary.getSprite("but_exit");d=CANVAS_WIDTH-l.width/2-6;e=l.height/2+6;z=new CGfxButton(d,e,l,!0);z.addEventListener(ON_MOUSE_UP,this._onExit,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)q=d-l.width,u=l.height/2+6,l=s_oSpriteLibrary.getSprite("audio_icon"),A=new CToggle(q,u,l,s_bAudioActive),A.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);l=window.document;var I=l.documentElement;x=I.requestFullscreen||I.mozRequestFullScreen||I.webkitRequestFullScreen||I.msRequestFullscreen;
p=l.exitFullscreen||l.mozCancelFullScreen||l.webkitExitFullscreen||l.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(x=!1);x&&screenfull.isEnabled&&(l=s_oSpriteLibrary.getSprite("but_fullscreen"),f=d,m=CANVAS_HEIGHT-l.height/2,r=new CToggle(f,m,l,s_bFullscreen,s_oStage),r.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));K=new CNextLevel;H=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){z.unload();z=null;!1===DISABLE_SOUND_MOBILE&&
(A.unload(),A=null);x&&screenfull.isEnabled&&r.unload();s_oStage.removeAllChildren();s_oInterface=null};this.refreshButtonPos=function(l,B){w.x=g+l;w.y=c+B;v.x=n+l;v.y=h+B;z.setPosition(d-l,e+B);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||A.setPosition(q-l,B+u);x&&screenfull.isEnabled&&r.setPosition(f-l,m-B)};this._onTapScreen=function(l,B){s_oGame.onShot(l,B)};this.gameOver=function(l){H.show(l,!1)};this.win=function(l){H.show(l,!0)};this.nextLevel=function(l,B){K.show(l,B)};this.refreshScore=function(l){w.text=
TEXT_SCORE+" "+l};this.refreshLevel=function(l){v.text=TEXT_LEVEL+" "+l};this._onExit=function(){s_oGame.onExit()};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this.resetFullscreenBut=function(){x&&screenfull.isEnabled&&r.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?p.call(window.document):x.call(window.document.documentElement);sizeHandler()};s_oInterface=this;this._init(b);return this}var s_oInterface=null;
function CEndPanel(b){var d,e,f,m,n,h;this._init=function(g){h=new createjs.Container;h.alpha=0;h.visible=!1;s_oStage.addChild(h);d=createBitmap(g);h.addChild(d);n=new CTLText(h,CANVAS_WIDTH/2-80,CANVAS_HEIGHT/2-68,210,30,50,"center","#000",FONT_GAME,1.1,0,0,TEXT_CONGRATS,!0,!0,!0,!1);m=new CTLText(h,CANVAS_WIDTH/2-80,CANVAS_HEIGHT/2-68,210,30,50,"center","#fff",FONT_GAME,1.1,0,0,TEXT_CONGRATS,!0,!0,!0,!1);e=new CTLText(h,CANVAS_WIDTH/2-80,CANVAS_HEIGHT/2-15,200,70,50,"center","#000",FONT_GAME,1.1,
0,0,TEXT_FINAL_SCORE+"\n99999",!0,!0,!0,!1);f=new CTLText(h,CANVAS_WIDTH/2-80,CANVAS_HEIGHT/2-15,200,70,50,"center","#fff",FONT_GAME,1.1,0,0,TEXT_FINAL_SCORE+"\n99999",!0,!0,!0,!1)};this.unload=function(){h.off("mousedown",this._onExit);s_oStage.removeChild(h)};this._initListener=function(){h.on("mousedown",this._onExit);$(s_oMain).trigger("show_interlevel_ad")};this.show=function(g,c){c?(n.refreshText(TEXT_CONGRATS),m.refreshText(TEXT_CONGRATS)):(n.refreshText(TEXT_GAMEOVER),m.refreshText(TEXT_GAMEOVER));
e.refreshText(TEXT_FINAL_SCORE+"\n "+g);f.refreshText(TEXT_FINAL_SCORE+"\n "+g);h.visible=!0;var q=this;createjs.Tween.get(h).to({alpha:1},500).call(function(){q._initListener()});$(s_oMain).trigger("save_score",g)};this._onExit=function(){h.off("mousedown");s_oGame.onExit()};this._init(b);return this}
function CTweenController(){this.tweenValue=function(b,d,e){return b+e*(d-b)};this.easeLinear=function(b,d,e,f){return e*b/f+d};this.easeInCubic=function(b,d,e,f){f=(b/=f)*b*b;return d+e*f};this.easeBackInQuart=function(b,d,e,f){f=(b/=f)*b;return d+e*(2*f*f+2*f*b+-3*f)};this.easeInBack=function(b,d,e,f){return e*(b/=f)*b*(2.70158*b-1.70158)+d};this.easeOutCubic=function(b,d,e,f){return e*((b=b/f-1)*b*b+1)+d}}
function CLevelSettings(b){var d,e,f,m,n,h,g;this._init=function(c){d=c;NUM_LEVELS=Object.keys(d).length;this._initBallSpeed();this._initBallNumber();this._initBallColors();this._initHeroPos();this._initCurveLevel();this._initBgLevel()};this._initBallSpeed=function(){e=[];for(var c=0;c<NUM_LEVELS;c++)e[c]=d[c].ball_speed};this._initBallNumber=function(){f=[];for(var c=0;c<NUM_LEVELS;c++)f[c]=d[c].ball_number};this._initBallColors=function(){m=[];for(var c=0;c<NUM_LEVELS;c++)m[c]=d[c].num_colors};
this._initHeroPos=function(){n=[];for(var c=0;c<NUM_LEVELS;c++)n[c]=new createjs.Point(d[c].hero_pos.x,d[c].hero_pos.y)};this._initCurveLevel=function(){h=[];for(var c=0;c<NUM_LEVELS;c++){h[c]=[];for(var q=d[c].curve_point,u=0;u<q.length;u++)h[c].push([q[u].x,q[u].y])}};this._initBgLevel=function(){g=[];for(var c=0;c<NUM_LEVELS;c++)g[c]=d[c].bg_image};this.getBallSpeedForLevel=function(c){return e[c-1]};this.getBallNumberForLevel=function(c){return f[c-1]};this.getBallColorsForLevel=function(c){return m[c-
1]};this.getHeroPosForLevel=function(c){return n[c-1]};this.getCurveForLevel=function(c){return h[c-1]};this.getNumLevels=function(){return h.length};this.getBgForLevel=function(c){return g[c-1]};this._init(b)}
function CHero(){var b=!1,d,e,f,m,n,h,g,c,q,u;this._init=function(){var v=s_oSpriteLibrary.getSprite("hero");u=new createjs.Container;u.regX=v.width/2;u.regY=v.height/2;s_oStage.addChild(u);g=createBitmap(v);g.x=0;g.y=0;u.addChild(g);c=new createjs.Shape;c.graphics.beginFill("rgba(255,0,0,0.01)").drawCircle(40,110,16);u.addChild(c);q=new createjs.Shape;q.graphics.beginFill("rgba(255,0,0,0.01)").drawCircle(120,60,6);u.addChild(q);d=v.width;e=v.height};this.reset=function(v,w){f=w;void 0!==n&&null!==
n&&n.unload();void 0!==h&&null!==h&&h.unload();u.x=v.x;u.y=v.y;m=[];for(var z=0;z<f;z++)m[z]=!0};this.unload=function(){};this.rotate=function(v){u.rotation=v};this.start=function(){n=this._getRandomBall();n.changePos(d/2-25,e/2+20);n.getSprite().mask=c;h=this._getRandomBall();h.changePos(120,e/2-12);h.getSprite().mask=q;var v=this;createjs.Tween.get(n.getSprite()).to({y:n.getY()+25},300).call(function(){v._onBallReady()});createjs.Tween.get(h.getSprite()).to({y:h.getY()+16},300)};this._getRandomBall=
function(){if(!0===this._checkIfAllColorsNotAvailable())return null;do{var v=Math.floor(Math.random()*f),w=!1;if(!0===m[v]){var z=new CBall(v,u);break}}while(!1===w);return z};this._checkIfAllColorsNotAvailable=function(){for(var v=!0,w=0;w<m.length;w++)!0===m[w]&&(v=!1);return v};this._nextShoot=function(){null!==n&&n.unload();n=h;n.changePos(d/2-25,e/2+20);n.getSprite().mask=c;h=this._getRandomBall();h.changePos(120,e/2-12);h.getSprite().mask=q;var v=this;createjs.Tween.get(n.getSprite()).to({y:n.getY()+
25},300).call(function(){v._onBallReady()});createjs.Tween.get(h.getSprite()).to({y:h.getY()+16},300)};this.colorCleared=function(v){m[v]=!1;n.getIndex()===v&&(n.unload(),n=this._getRandomBall(),null!==n&&(n.changePos(d/2-25,e/2+45),n.getSprite().mask=c));h.getIndex()===v&&(h.unload(),h=this._getRandomBall(),null!==h&&(h.changePos(120,e/2+4),h.getSprite().mask=q))};this._onBallReady=function(){b=!0};this.getCurrentBall=function(){b=!1;var v=n;this._nextShoot();return v};this.getX=function(){return u.x};
this.getY=function(){return u.y};this.getRotation=function(){return u.rotation};this.canShoot=function(){return b};this._init()}
function CBezier(){var b,d,e,f,m,n,h,g,c,q,u,v;this.init=function(w,z,F,A){b=w;d=z;e=F;m=b.x-2*d.x+e.x;n=b.y-2*d.y+e.y;h=2*d.x-2*b.x;g=2*d.y-2*b.y;c=4*(m*m+n*n);q=4*(m*h+n*g);u=h*h+g*g;v=this._length(1);f=Math.floor(v/A);v%A>A/2&&f++;return f};this._speed=function(w){return Math.sqrt(c*w*w+q*w+u)};this._length=function(w){var z=Math.sqrt(u+w*(q+c*w));return(2*Math.sqrt(c)*(2*c*w*z+q*(z-Math.sqrt(u)))+(q*q-4*c*u)*(Math.log(q+2*Math.sqrt(c)*Math.sqrt(u))-Math.log(q+2*c*w+2*Math.sqrt(c)*z)))/(8*Math.pow(c,
1.5))};this.invertL=function(w,z){var F=w;do{var A=F-(this._length(F)-z)/this._speed(F);if(1E-6>Math.abs(F-A))break;F=A}while(1);return A};this.getAnchorPoint=function(w){if(0<=w&&w<=f){var z=w/f;z=this.invertL(z,z*v);w=(1-z)*(1-z)*b.x+2*(1-z)*z*d.x+z*z*e.x;var F=(1-z)*(1-z)*b.y+2*(1-z)*z*d.y+z*z*e.y,A=new createjs.Point((1-z)*b.x+z*d.x,(1-z)*b.y+z*d.y);z=new createjs.Point((1-z)*d.x+z*e.x,(1-z)*d.y+z*e.y);return[w,F,180*Math.atan2(z.y-A.y,z.x-A.x)/Math.PI]}return[]}}
function CBall(b,d){var e,f,m,n,h;this._init=function(g,c){e=g;f=0;h=c;var q=s_oSpriteLibrary.getSprite("ball_"+e);BALL_DIAMETER=q.width;BALL_DIAMETER_SQUARE=BALL_DIAMETER*BALL_DIAMETER;BALL_RADIUS=BALL_DIAMETER/2;q=new createjs.SpriteSheet({images:[q],frames:{width:BALL_DIAMETER,height:BALL_DIAMETER,regX:BALL_RADIUS,regY:BALL_RADIUS},animations:{move:[0,49]}});m=createSprite(q,null,BALL_RADIUS,BALL_RADIUS,BALL_DIAMETER,BALL_DIAMETER);m.stop();h.addChild(m)};this.unload=function(){h.removeChild(n);
h.removeChild(m)};this.nextFrame=function(){m.gotoAndStop(50===m.currentFrame+1?0:m.currentFrame+1)};this.prevFrame=function(){m.gotoAndStop(0>m.currentFrame-1?49:m.currentFrame-1)};this.setPos=function(g,c){g>f?this.nextFrame():g<f&&this.prevFrame();f=g;m.x=c[f][0];m.y=c[f][1];m.rotation=c[f][2]-90};this.changePos=function(g,c){m.x=g;m.y=c};this.increasePosWithNumbers=function(g,c){m.x+=g;m.y+=c};this.decreasePos=function(g,c){m.x-=g;m.y-=c};this.increasePos=function(g,c){this.setPos(f+g,c)};this.setContainer=
function(g){m.mask=null;h=g};this.explode=function(){var g={images:[s_oSpriteLibrary.getSprite("explosion")],frames:{width:30,height:30,regX:15,regY:15},animations:{show:[0,19],hide:[20]}},c=this;g=new createjs.SpriteSheet(g,"show");n=new createjs.Sprite(g);h.addChild(n);n.x=m.x;n.y=m.y;n.gotoAndPlay("show");createjs.Tween.get(m).to({alpha:0},1E3,createjs.Ease.cubicOut).call(function(){m.visible=!1});createjs.Tween.get(n).to({alpha:0},1200,createjs.Ease.cubicOut).call(function(){c.onExplosionEnd()})};
this.onExplosionEnd=function(){h.removeChild(n);h.removeChild(m)};this.rollInStage=function(){};this.getFotogram=function(){return f};this.getSprite=function(){return m};this.getIndex=function(){return e};this.getX=function(){return m.x};this.getY=function(){return m.y};this._init(b,d)}
function CNextLevel(){var b,d,e,f,m,n;this._init=function(){n=new createjs.Container;n.alpha=0;n.visible=!1;s_oStage.addChild(n);b=createBitmap(s_oSpriteLibrary.getSprite("msg_box"));n.addChild(b);e=new CTLText(n,CANVAS_WIDTH/2-80,CANVAS_HEIGHT/2-68,210,30,50,"center","#000",FONT_GAME,1.1,0,0,TEXT_CONGRATS,!0,!0,!0,!1);d=new CTLText(n,CANVAS_WIDTH/2-80,CANVAS_HEIGHT/2-68,210,30,50,"center","#fff",FONT_GAME,1.1,0,0,TEXT_CONGRATS,!0,!0,!0,!1);m=new CTLText(n,CANVAS_WIDTH/2-80,CANVAS_HEIGHT/2-15,200,
70,50,"center","#000",FONT_GAME,1.1,0,0,TEXT_FINAL_SCORE+"\n99999",!0,!0,!0,!1);f=new CTLText(n,CANVAS_WIDTH/2-80,CANVAS_HEIGHT/2-15,200,70,50,"center","#fff",FONT_GAME,1.1,0,0,TEXT_FINAL_SCORE+"\n99999",!0,!0,!0,!1)};this.show=function(h,g){e.refreshText(TEXT_LEVEL+" "+h);d.refreshText(TEXT_LEVEL+" "+h);m.refreshText(TEXT_SCORE+" "+g);f.refreshText(TEXT_SCORE+" "+g);n.visible=!0;var c=this;createjs.Tween.get(n).to({alpha:1},500).call(function(){c._initListener()});$(s_oMain).trigger("save_score",
g)};this._initListener=function(){n.on("mousedown",this._onExit);$(s_oMain).trigger("show_interlevel_ad")};this._onExit=function(){n.off("mousedown");n.alpha=0;n.visible=!1;s_oGame.nextLevel()};this._init()}function CExtraScore(b,d,e){var f;this._init=function(m,n,h){var g=s_oSpriteLibrary.getSprite("extra_score");f=createBitmap(g);f.x=m;f.y=n;f.regX=g.width/2;f.regY=g.height/2;f.alpha=0;h.addChild(f);createjs.Tween.get(f).to({alpha:1},1E3).call(function(){h.removeChild(f)})};this._init(b,d,e)}
function CLevelMenu(){var b,d,e,f,m,n,h,g,c,q,u,v,w,z=null,F=null,A,H,K=null,r=null;this._init=function(){h=0;A=new createjs.Container;s_oStage.addChild(A);var x=createBitmap(s_oSpriteLibrary.getSprite("bg_menu_level"));A.addChild(x);new CTLText(s_oStage,250,60,460,60,100,"center","#fff",FONT_GAME,1.1,0,0,TEXT_SELECT_LEVEL,!0,!0,!0,!1);x=s_oSpriteLibrary.getSprite("but_exit");m=CANVAS_WIDTH-x.width/2-6;n=x.height/2+6;v=new CGfxButton(m,n,x,!0);v.addEventListener(ON_MOUSE_UP,this._onExit,this);g=x.height;
if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)e=v.getX()-x.width,f=x.height/2+6,w=new CToggle(e,f,s_oSpriteLibrary.getSprite("audio_icon"),s_bAudioActive),w.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);x=window.document;var p=x.documentElement;K=p.requestFullscreen||p.mozRequestFullScreen||p.webkitRequestFullScreen||p.msRequestFullscreen;r=x.exitFullscreen||x.mozCancelFullScreen||x.webkitExitFullscreen||x.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(K=!1);K&&screenfull.isEnabled&&(x=s_oSpriteLibrary.getSprite("but_fullscreen"),
b=x.width/4+6,d=x.height/2+6,H=new CToggle(b,d,x,s_bFullscreen,s_oStage),H.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));this._checkBoundLimits();q=[];x=Math.floor((CANVAS_WIDTH-2*EDGEBOARD_X)/NUM_COLS_PAGE_LEVEL)/2;for(var l=p=0;l<NUM_COLS_PAGE_LEVEL;l++)q.push(p),p+=2*x;u=[];this._createNewLevelPage(0,NUM_LEVELS);if(1<u.length){for(x=1;x<u.length;x++)u[x].visible=!1;z=new CGfxButton(CANVAS_WIDTH/2+280,CANVAS_HEIGHT-80,s_oSpriteLibrary.getSprite("arrow_right"),!0);z.addEventListener(ON_MOUSE_UP,
this._onRight,this);F=new CGfxButton(CANVAS_WIDTH/2-280,CANVAS_HEIGHT-80,s_oSpriteLibrary.getSprite("arrow_left"),!0);F.addEventListener(ON_MOUSE_UP,this._onLeft,this)}this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){for(var x=0;x<c.length;x++)c[x].unload();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||w.unload();K&&screenfull.isEnabled&&H.unload();v.unload();null!==F&&(F.unload(),z.unload());s_oLevelMenu=null};this.refreshButtonPos=function(x,p){v.setPosition(m-x,n+p);!1!==DISABLE_SOUND_MOBILE&&
!1!==s_bMobile||w.setPosition(e-x,p+f);K&&screenfull.isEnabled&&H.setPosition(b+x,d+p)};this._checkBoundLimits=function(){for(var x=s_oSpriteLibrary.getSprite("but_level"),p=0,l=CANVAS_HEIGHT-2*EDGEBOARD_Y-2*g,B=0;p<l;)p+=x.height+20,B++;NUM_ROWS_PAGE_LEVEL>B&&(NUM_ROWS_PAGE_LEVEL=B);l=p=0;B=CANVAS_WIDTH-2*EDGEBOARD_X;for(x=s_oSpriteLibrary.getSprite("but_level");l<B;)l+=x.width/2+5,p++;NUM_COLS_PAGE_LEVEL>p&&(NUM_COLS_PAGE_LEVEL=p)};this._createNewLevelPage=function(x,p){var l=new createjs.Container;
A.addChild(l);u.push(l);c=[];for(var B=0,I=0,C=1,X=!1,R=s_oSpriteLibrary.getSprite("but_level"),N=x;N<p;N++){var Q=new CLevelBut(q[B]+R.width/4,I+R.height/2,N+1,R,N+1>s_iLastLevel?!1:!0,l);Q.addEventListenerWithParams(ON_MOUSE_UP,this._onButLevelRelease,this,N);c.push(Q);B++;if(B===q.length&&(B=0,I+=R.height+20,C++,C>NUM_ROWS_PAGE_LEVEL)){X=!0;break}}l.x=CANVAS_WIDTH/2;l.y=CANVAS_HEIGHT/2;l.regX=l.getBounds().width/2;l.regY=l.getBounds().height/2;X&&this._createNewLevelPage(N+1,p)};this._onRight=
function(){u[h].visible=!1;h++;h>=u.length&&(h=0);u[h].visible=!0};this._onLeft=function(){u[h].visible=!1;h--;0>h&&(h=u.length-1);u[h].visible=!0};this._onButLevelRelease=function(x){s_oMain.levelSelected(x+1)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this.resetFullscreenBut=function(){K&&screenfull.isEnabled&&H.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?r.call(window.document):K.call(window.document.documentElement);
sizeHandler()};this._onExit=function(){s_oMain.gotoMenu()};s_oLevelMenu=this;this._init()}var s_oLevelMenu=null;
function CLevelBut(b,d,e,f,m,n){var h,g,c,q=[],u=[],v,w,z,F;this._init=function(H,K,r,x,p){g=[];c=[];F=new createjs.Container;A.addChild(F);var l=new createjs.SpriteSheet({images:[x],frames:{width:x.width/2,height:x.height,regX:x.width/2/2,regY:x.height/2},animations:{state_true:[0],state_false:[1]}});h=p;z=createSprite(l,"state_"+h,x.width/2/2,x.height/2,x.width/2,x.height);z.mouseEnabled=p;z.x=H;z.y=K;z.stop();s_bMobile||(F.cursor="pointer");F.addChild(z);q.push(z);v=new createjs.Text(r,"60px "+
FONT_GAME,"#004e6f");v.x=H;v.y=K+20;v.textAlign="center";v.textBaseline="alphabetic";v.lineWidth=200;v.outline=6;F.addChild(v);w=new createjs.Text(r,"60px "+FONT_GAME,"#fff");w.x=H;w.y=K+20;w.textAlign="center";w.textBaseline="alphabetic";w.lineWidth=200;F.addChild(w);p||(w.color="#b4b4b4",v.color="#606161");this._initListener()};this.unload=function(){F.off("mousedown",this.buttonDown);F.off("pressup",this.buttonRelease);F.removeChild(z)};this._initListener=function(){F.on("mousedown",this.buttonDown);
F.on("pressup",this.buttonRelease)};this.viewBut=function(H){F.addChild(H)};this.addEventListener=function(H,K,r){g[H]=K;c[H]=r};this.addEventListenerWithParams=function(H,K,r,x){g[H]=K;c[H]=r;u=x};this.ifClickable=function(){return!0===F.mouseEnabled?1:0};this.setActive=function(H,K){h=K;q[H].gotoAndStop("state_"+h);q[H].mouseEnabled=!0;h?(w.color="#69b8d5",v.color="#004e6f"):(w.color="#b4b4b4",v.color="#606161")};this.buttonRelease=function(){h&&(playSound("press_but",1,!1),g[ON_MOUSE_UP]&&g[ON_MOUSE_UP].call(c[ON_MOUSE_UP],
u))};this.buttonDown=function(){g[ON_MOUSE_DOWN]&&g[ON_MOUSE_DOWN].call(c[ON_MOUSE_DOWN],u)};this.setPosition=function(H,K){F.x=H;F.y=K};this.setVisible=function(H){F.visible=H};var A=n;this._init(b,d,e,f,m,n)}
function CMsgBox(b,d,e,f){var m,n,h,g,c,q,u;this._init=function(v,w,z,F){m=[];n=[];u=new createjs.Container;s_oStage.addChild(u);var A=createBitmap(s_oSpriteLibrary.getSprite("msg_box"));u.addChild(A);h=new CTLText(u,CANVAS_WIDTH/2-80,CANVAS_HEIGHT/2-80,210,130,50,"center","#fff",FONT_GAME,1.1,0,0,"",!0,!0,!0,!1);g=new CTextButton(CANVAS_WIDTH/2-100,CANVAS_HEIGHT-150,s_oSpriteLibrary.getSprite("but_generic_small"),"LEFT",FONT_GAME,"#ffffff",50,u);g.addEventListener(ON_MOUSE_UP,this._onButLeftDownRelease,
this);c=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT-150,s_oSpriteLibrary.getSprite("but_generic_small"),"CENTER",FONT_GAME,"#ffffff",50,u);c.addEventListener(ON_MOUSE_UP,this._onButCenterDownRelease,this);q=new CTextButton(CANVAS_WIDTH/2+90,CANVAS_HEIGHT-150,s_oSpriteLibrary.getSprite("but_generic_small"),"LEFT",FONT_GAME,"#ffffff",50,u);q.addEventListener(ON_MOUSE_UP,this._onButRightDownRelease,this);this.show(v,w,z,F)};this.show=function(v,w,z,F){h.refreshText(v);""!==w?(g.changeText(w),g.setVisible(!0)):
g.setVisible(!1);""!==z?(c.changeText(z),c.setVisible(!0)):c.setVisible(!1);""!==F?(q.changeText(F),q.setVisible(!0)):q.setVisible(!1)};this.hide=function(){this.unload();s_oStage.removeChild(u)};this.unload=function(){g.unload();c.unload();q.unload()};this.addEventListener=function(v,w,z){m[v]=w;n[v]=z};this._onButLeftDownRelease=function(){m[ON_MSG_BOX_LEFT_BUT]&&(m[ON_MSG_BOX_LEFT_BUT].call(n[ON_MSG_BOX_LEFT_BUT]),u.visible=!1)};this._onButCenterDownRelease=function(){m[ON_MSG_BOX_CENTER_BUT]&&
(m[ON_MSG_BOX_CENTER_BUT].call(n[ON_MSG_BOX_CENTER_BUT]),u.visible=!1)};this._onButRightDownRelease=function(){m[ON_MSG_BOX_RIGHT_BUT]&&(m[ON_MSG_BOX_RIGHT_BUT].call(n[ON_MSG_BOX_RIGHT_BUT]),u.visible=!1)};this._init(b,d,e,f)}
function CCreditsPanel(){var b,d,e,f,m,n,h;this._init=function(){h=new createjs.Container;h.alpha=0;s_oStage.addChild(h);var g=new createjs.Shape;g.graphics.beginFill("rgba(0,0,0,0.7)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);h.addChild(g);d=createBitmap(s_oSpriteLibrary.getSprite("msg_box"));h.addChild(d);m=new createjs.Shape;m.graphics.beginFill("#0f0f0f").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);m.alpha=.01;b=m.on("click",this._onLogoButRelease);h.addChild(m);g=s_oSpriteLibrary.getSprite("but_exit_small");
f=new CGfxButton(620,180,g,h);f.addEventListener(ON_MOUSE_UP,this.unload,this);g=s_oSpriteLibrary.getSprite("logo_ctl");e=createBitmap(g);e.regX=g.width/2;e.regY=g.height/2;e.x=CANVAS_WIDTH/2+20;e.y=265;h.addChild(e);n=new CTLText(h,400,286,200,30,50,"center","#000",FONT_GAME,1.1,0,0,"www.codethislab.com",!0,!0,!0,!1);n.setOutline(2);new CTLText(h,400,286,200,30,50,"center","#fff",FONT_GAME,1.1,0,0,"www.codethislab.com",!0,!0,!0,!1);createjs.Tween.get(h).to({alpha:1},600,createjs.Ease.cubicOut);this.refreshButtonPos(s_iOffsetX,
s_iOffsetY)};this.refreshButtonPos=function(g,c){};this.unload=function(){m.off("click",b);f.unload();f=null;s_oStage.removeChild(h)};this._onLogoButRelease=function(){window.open("http://www.codethislab.com/index.php?&l=en","_blank")};this._init()}
function CAlertSavingBox(b,d){var e,f;this._init=function(h){f=new createjs.Container;n.addChild(f);var g=new createjs.Shape;g.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);g.alpha=.5;g.on("click",function(){});f.addChild(g);g=s_oSpriteLibrary.getSprite("msg_box");var c=createBitmap(g);c.x=.5*CANVAS_WIDTH;c.y=.5*CANVAS_HEIGHT;c.regX=.5*g.width;c.regY=.5*g.height;f.addChild(c);new CTLText(f,400,190,200,130,50,"center","#fff",FONT_GAME,1.1,0,0,h,!0,!0,!0,!1);e=new CGfxButton(CANVAS_WIDTH/
2,430,s_oSpriteLibrary.getSprite("but_exit"),f);e.addEventListener(ON_MOUSE_UP,this._onButOk,this)};this._onButOk=function(){m.unload()};this.unload=function(){e.unload();n.removeChild(f)};var m=this;var n=d;this._init(b)}
CTLText.prototype={constructor:CTLText,__autofit:function(){if(this._bFitText){for(var b=this._iFontSize;(this._oText.getBounds().height>this._iHeight-2*this._iPaddingV||this._oText.getBounds().width>this._iWidth-2*this._iPaddingH)&&!(b--,this._oText.font=b+"px "+this._szFont,this._oText.lineHeight=Math.round(b*this._fLineHeightFactor),this.__updateY(),this.__verticalAlign(),8>b););this._iFontSize=b}},__verticalAlign:function(){if(this._bVerticalAlign){var b=this._oText.getBounds().height;this._oText.y-=
(b-this._iHeight)/2+this._iPaddingV}},__updateY:function(){this._oText.y=this._y+this._iPaddingV;switch(this._oText.textBaseline){case "middle":this._oText.y+=this._oText.lineHeight/2+(this._iFontSize*this._fLineHeightFactor-this._iFontSize)}},__createText:function(b){this._bDebug&&(this._oDebugShape=new createjs.Shape,this._oDebugShape.graphics.beginFill("rgba(255,0,0,0.5)").drawRect(this._x,this._y,this._iWidth,this._iHeight),this._oContainer.addChild(this._oDebugShape));this._oText=new createjs.Text(b,
this._iFontSize+"px "+this._szFont,this._szColor);this._oText.textBaseline="middle";this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this._oText.textAlign=this._szAlign;this._oText.lineWidth=this._bMultiline?this._iWidth-2*this._iPaddingH:null;switch(this._szAlign){case "center":this._oText.x=this._x+this._iWidth/2;break;case "left":this._oText.x=this._x+this._iPaddingH;break;case "right":this._oText.x=this._x+this._iWidth-this._iPaddingH}this._oContainer.addChild(this._oText);
this.refreshText(b)},setVerticalAlign:function(b){this._bVerticalAlign=b},setOutline:function(b){null!==this._oText&&(this._oText.outline=b)},setShadow:function(b,d,e,f){null!==this._oText&&(this._oText.shadow=new createjs.Shadow(b,d,e,f))},setColor:function(b){this._oText.color=b},setAlpha:function(b){this._oText.alpha=b},removeTweens:function(){createjs.Tween.removeTweens(this._oText)},getText:function(){return this._oText},getY:function(){return this._y},getFontSize:function(){return this._iFontSize},
refreshText:function(b){""===b&&(b=" ");null===this._oText&&this.__createText(b);this._oText.text=b;this._oText.font=this._iFontSize+"px "+this._szFont;this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this.__autofit();this.__updateY();this.__verticalAlign()}};
function CTLText(b,d,e,f,m,n,h,g,c,q,u,v,w,z,F,A,H){this._oContainer=b;this._x=d;this._y=e;this._iWidth=f;this._iHeight=m;this._bMultiline=A;this._iFontSize=n;this._szAlign=h;this._szColor=g;this._szFont=c;this._iPaddingH=u;this._iPaddingV=v;this._bVerticalAlign=F;this._bFitText=z;this._bDebug=H;this._oDebugShape=null;this._fLineHeightFactor=q;this._oText=null;w&&this.__createText(w)};